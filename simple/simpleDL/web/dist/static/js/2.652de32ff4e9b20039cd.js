webpackJsonp([2],{vIVt:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("hRKE"),o=a.n(i),s=a("4YfN"),r=a.n(s),l=a("v46e"),n={name:"newImage",data:function(){var e=this,t=function(t,a,i){l.e(a)?""===a.trim()?i(new Error(e.$t("views.validError.notNull"))):i():i(new Error(e.$t("views.validError.validStr")))};return{lang:"zh",is_init:2,openDialog1:!1,openDialog2:!1,isCreatBtn:!1,ruleForm:{name:"",category:"",os:"",project_id:"",describe:"",path:""},dailogForm1:{categoryName:""},dailogForm2:{osName:""},dailogFormRules1:{categoryName:[{required:!0,message:this.$t("views.validError.notNull"),trigger:"blur"},{validator:t,trigger:"blur"}]},dailogFormRules2:{osName:[{required:!0,message:this.$t("views.validError.notNull"),trigger:"blur"},{validator:t,trigger:"blur"}]},rules:{name:[{required:!0,message:this.$t("views.validError.notNull"),trigger:"blur"},{validator:function(t,a,i){l.k(a)?i():i(new Error(e.$t("views.userManagement.tips.validateUsername")))},trigger:"blur"}],category:[{required:!0,message:this.$t("views.validError.notNull"),trigger:"change"}],os:[{required:!0,message:this.$t("views.validError.notNull"),trigger:"change"}],path:[{required:!0,message:this.$t("views.imageManagement.uploadError"),trigger:"change"}],project_id:[{required:!0,message:this.$t("views.validError.notNull"),trigger:"change"}]},seletions:{},proSpaces:[],url:"",labelWidth:"120px",isEdit:!1,hasObjectData:!1,para:{target:window.Simple.php+"/v1/image/imageupload",headers:{Authorization:"Bearer "+sessionStorage.getItem("access_token")},token:sessionStorage.getItem("access_token"),typeArr:["tar"],checkChunkUploadedByResponse:function(e,t){var a={};try{a.index=t?JSON.parse(t).data.index:0}catch(e){}return(a.index||0)>e.offset},chunkSize:20971520}}},watch:{STORE_THEME_LANG:{handler:function(e,t){e&&(this.lang=this.STORE_THEME_LANG)}}},beforeRouteEnter:function(e,t,a){a(function(e){0===e.is_init&&e.$nextTick(function(){e.$route.meta.markName="personalImage"}),2===e.is_init&&e.$nextTick(function(){e.$route.meta.markName="objectImage"}),1===e.is_init&&e.$nextTick(function(){e.$route.meta.markName="publicImage"})})},created:function(){var e=this;this.is_init=this.$route.query.is_init-0,2===this.is_init&&this.$post("/image/projectlist").then(function(t){e.proSpaces=t.data}),this.selectData(),void 0!==this.$route.query.imageId?(this.imageId=this.$route.query.imageId,this.isEdit=!0,this.url="/image/imageupdate?image_id="+this.$route.query.imageId,this.$get("/image/imagedetails",{image_id:this.$route.query.imageId}).then(function(t){2===e.is_init&&(e.proSpaces=[{id:t.data.image.project.id,name:t.data.image.project.name}],e.ruleForm.project_id=t.data.image.project_id),e.ruleForm.name=t.data.image.name,e.ruleForm.category=t.data.image.category,e.ruleForm.os=t.data.image.os,e.ruleForm.describe=t.data.image.describe,e.ruleForm.upload_path=t.data.image.upload_path})):this.url="/image/imagecreate",void 0!==this.$route.query.hasObjectData&&(this.hasObjectData=!0)},methods:{selectData:function(){var e=this;this.$get("/image/imagecategorylist",{is_init:this.is_init}).then(function(t){e.seletions=r()({},t.data)})},handleClose1:function(){this.$refs.dailogForm1.resetFields(),this.ruleForm.category=""},handleClose2:function(){this.$refs.dailogForm2.resetFields(),this.ruleForm.os=""},handleSure1:function(){var e=this;this.$refs.dailogForm1.validate(function(t){t&&e.$post("/image/imagecategorycreate",{category_name:e.dailogForm1.categoryName}).then(function(t){200===t.code?(e.$message({type:"success",message:e.$t("views.notification.saved")}),e.seletions.category.push(t.data),e.openDialog1=!1,e.$nextTick(function(){this.ruleForm.category=t.data.id})):e.$message({type:"warning",message:t.message})})})},handleSure2:function(){var e=this;this.$refs.dailogForm2.validate(function(t){t&&e.$post("/image/imageoscreate",{os_name:e.dailogForm2.osName}).then(function(t){200===t.code?(e.$message({type:"success",message:e.$t("views.notification.saved")}),e.seletions.os.push(t.data),e.openDialog2=!1,e.$nextTick(function(){this.ruleForm.os=t.data.id})):e.$message({type:"warning",message:t.message})})})},changeCategory:function(){-1===this.ruleForm.category&&(this.openDialog1=!0)},changeOS:function(){-1===this.ruleForm.os&&(this.openDialog2=!0)},delOS:function(e){var t=this,a=this.seletions.os[e];this.$post("/image/imageosdelete",a).then(function(a){200===a.code?(t.$message({type:"success",message:t.$t("views.notification.removed")}),t.seletions.os.splice(e,1),t.ruleForm.os=""):t.ruleForm.os=""})},delCategory:function(e){var t=this,a=this.seletions.category[e];this.$post("/image/imagecategorydelete",{category_id:a.id}).then(function(a){200===a.code?(t.$message({type:"success",message:t.$t("views.notification.removed")}),t.seletions.category.splice(e,1),t.ruleForm.category=""):t.ruleForm.category=""})},uploadResult:function(e){var t="";t="object"===(void 0===e?"undefined":o()(e))?e:JSON.parse(e),console.log(t),200===t.code?(this.ruleForm.path=t.data.path,this.$refs.ruleForm.validate(function(e){console.log(e)})):(this.$message({type:"error",message:t.message}),this.isCreatBtn=!1)},deleteFile:function(e){var t=this;this.ruleForm.path="",this.$post("/image/filedelete",{path:this.ruleForm.path}).then(function(e){200===e.code?t.$message({type:"success",message:t.$t("views.notification.removed")}):t.$message({type:"error",message:e.message})})},submitForm:function(){var e=this;this.$refs.ruleForm.validate(function(t){t?(e.isCreatBtn=!0,e.ruleForm.is_init=e.is_init,e.$post(e.url,{Image:e.ruleForm,path:e.ruleForm.path}).then(function(t){200===t.code?(e.$message({message:e.$t("views.notification.saved"),type:"success"}),e.isCreatBtn=!1,e.$router.go(-1)):(100018===t.code&&(e.ruleForm.os=""),100017===t.code&&(e.ruleForm.category=""),e.isCreatBtn=!1,e.selectData())}).catch(function(t){e.isCreatBtn=!1,e.$message({type:"error",message:"服务器请求失败"})})):e.isCreatBtn=!1})}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"views-image-manage-new-image"},[a("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":e.labelWidth}},[a("el-row",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:e.$t("views.imageManagement.mirrorName"),prop:"name"}},[a("el-input",{attrs:{maxlength:"30"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("views.imageManagement.mirrorClassification"),prop:"category"}},[a("el-select",{attrs:{filterable:"",rel:"selCategory",placeholder:e.$t("views.imageManagement.chose")},on:{change:e.changeCategory},model:{value:e.ruleForm.category,callback:function(t){e.$set(e.ruleForm,"category",t)},expression:"ruleForm.category"}},[e._l(e.seletions.category,function(t,i){return a("el-option",{key:i,attrs:{label:t.name,value:t.id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"12px"},on:{click:function(t){return e.delCategory(i)}}},[a("i",{staticClass:"iconfont icon-shanchu"})])])}),e._v(" "),a("el-option",{key:-1,attrs:{label:e.$t("views.imageManagement.customize"),value:-1}})],2)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("views.imageManagement.operatingSystemType"),prop:"os"}},[a("el-select",{attrs:{filterable:"",placeholder:e.$t("views.imageManagement.chose")},on:{change:e.changeOS},model:{value:e.ruleForm.os,callback:function(t){e.$set(e.ruleForm,"os",t)},expression:"ruleForm.os"}},[e._l(e.seletions.os,function(t,i){return a("el-option",{key:i,attrs:{label:t.name,value:t.id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"12px"},on:{click:function(t){return e.delOS(i)}}},[a("i",{staticClass:"iconfont icon-shanchu"})])])}),e._v(" "),a("el-option",{key:-1,attrs:{label:e.$t("views.imageManagement.customize"),value:-1}})],2)],1),e._v(" "),e.isEdit?e._e():a("el-form-item",{attrs:{label:e.$t("views.imageManagement.imageFile"),prop:"path"}},[a("BreakpointUpload",{attrs:{params:e.para,language:e.lang},on:{resultUploader:e.uploadResult,deleteFiles:e.deleteFile}})],1)],1),e._v(" "),a("el-col",{attrs:{span:10,push:1}},[2===e.is_init?a("el-form-item",{attrs:{label:e.$t("views.imageManagement.imageSpace"),prop:"project_id"}},[a("el-select",{attrs:{filterable:"",disabled:e.isEdit,placeholder:e.$t("views.imageManagement.chooseImageSpace")},model:{value:e.ruleForm.project_id,callback:function(t){e.$set(e.ruleForm,"project_id",t)},expression:"ruleForm.project_id"}},e._l(e.proSpaces,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.$t("views.imageManagement.mirrorDescription"),prop:"describe"}},[a("el-input",{attrs:{type:"textarea",rows:5,maxlength:"200"},model:{value:e.ruleForm.describe,callback:function(t){e.$set(e.ruleForm,"describe",t)},expression:"ruleForm.describe"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:4}})],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"text-center"},[a("el-button",{on:{click:e.mixinGoBack}},[e._v(e._s(e.$t("views.button.cancel")))]),e._v(" "),a("el-button",{staticClass:"btn dark",attrs:{type:"primary",disabled:e.isCreatBtn},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(e._s(e.$t("views.button.save")))])],1)])],1),e._v(" "),a("el-dialog",{staticClass:"small",attrs:{title:e.$t("views.imageManagement.titleImageType"),visible:e.openDialog1},on:{close:e.handleClose1,"update:visible":function(t){e.openDialog1=t}}},[a("div",[a("el-form",{ref:"dailogForm1",attrs:{model:e.dailogForm1,rules:e.dailogFormRules1,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$t("views.imageManagement.typeImageName"),prop:"categoryName"}},[a("el-input",{attrs:{maxlength:"30",placeholder:e.$t("views.imageManagement.enter")},model:{value:e.dailogForm1.categoryName,callback:function(t){e.$set(e.dailogForm1,"categoryName",t)},expression:"dailogForm1.categoryName"}})],1)],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.openDialog1=!1}}},[e._v(e._s(e.$t("views.button.cancel")))]),e._v(" "),a("el-button",{staticClass:"btn dark",on:{click:e.handleSure1}},[e._v(e._s(e.$t("views.button.save")))])],1)]),e._v(" "),a("el-dialog",{staticClass:"small",attrs:{title:e.$t("views.imageManagement.titleOSType"),visible:e.openDialog2},on:{close:e.handleClose2,"update:visible":function(t){e.openDialog2=t}}},[a("div",[a("el-form",{ref:"dailogForm2",attrs:{model:e.dailogForm2,rules:e.dailogFormRules2,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"系统类型名称",prop:"osName"}},[a("el-input",{attrs:{maxlength:"30",placeholder:e.$t("views.imageManagement.enter")},model:{value:e.dailogForm2.osName,callback:function(t){e.$set(e.dailogForm2,"osName",t)},expression:"dailogForm2.osName"}})],1)],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.openDialog2=!1}}},[e._v(e._s(e.$t("views.button.cancel")))]),e._v(" "),a("el-button",{staticClass:"btn dark",on:{click:e.handleSure2}},[e._v(e._s(e.$t("views.button.save")))])],1)])],1)},staticRenderFns:[]},c=a("C7Lr")(n,m,!1,null,null,null);t.default=c.exports}});