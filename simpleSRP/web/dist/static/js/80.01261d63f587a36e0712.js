webpackJsonp([80],{"68dW":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("IHPB"),i=a.n(s),o=a("v46e"),l=a("aA9S"),n=a.n(l),r={name:"imageTableDialog",props:{selImageId:"",openDialog:{type:Boolean,default:!1}},data:function(){return{pageSize:10,selectImage:{id:0,name:""},tableData:{msg:[],url:"/casecenter/imagelist",loading:!0,Pagination:{page:1,status:1,is_init:1,total_count:5},sel:{name:""}}}},mounted:function(){this.getActiveTab("tableData")},updated:function(){this.selectImage.id=this.selImageId},methods:{getActiveTab:function(e){this.linTabData=e,this.linUrl=this[e].url,this.initMsg()},clearSearch:function(e){for(var t in this[e].sel)this[e].sel[t]="";void 0!==this[e].Pagination&&(this[e].Pagination.page=1),this.getActiveTab(e)},doSearch:function(e){void 0!==this[e].Pagination&&(this[e].Pagination.page=1),this.getActiveTab(e)},changePage:function(e){this.getActiveTab(e)},initMsg:function(){var e=this;this[this.linTabData].loading=!0;var t={};void 0!==this[this.linTabData].Pagination&&(t=n()({},this[this.linTabData].Pagination,{count:this.pageSize})),void 0!==this[this.linTabData].sel&&(this[this.linTabData].sel.full_date&&2===this[this.linTabData].sel.full_date.length?(this[this.linTabData].sel.star_date=this[this.linTabData].sel.full_date[0],this[this.linTabData].sel.end_date=this[this.linTabData].sel.full_date[1]):(this[this.linTabData].sel.star_date="",this[this.linTabData].sel.end_date=""),t=n()({},t,this[this.linTabData].sel)),this.$axios.get(this[this.linTabData].url,{params:t}).then(function(t){var a=t.data.data.image_list;e[e.linTabData].msg=[].concat(i()(a)),void 0!==e[e.linTabData].Pagination&&(e[e.linTabData].Pagination.total_count=t.data.data.total_count),e.pageSize=t.data.data.per_page||10,e[e.linTabData].loading=!1})},getCurrentRow:function(e,t){this.selectImage.id=e,this.selectImage.name=t},handleClose:function(e){this.$emit("modalClose")},selectImages:function(){this.$emit("selectImage",this.selectImage)}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"选择关联镜像",width:"80%","before-close":e.handleClose,"close-on-click-modal":!1,visible:e.openDialog},on:{"update:visible":function(t){e.openDialog=t}}},[a("div",{staticClass:"image-sel"},[a("div",{staticClass:"query-v"},[a("span",[e._v("镜像名称")]),e._v(" "),a("el-input",{attrs:{size:"small"},model:{value:e.tableData.sel.name,callback:function(t){e.$set(e.tableData.sel,"name",t)},expression:"tableData.sel.name"}}),e._v(" "),a("el-button",{staticClass:"views-btn-query",on:{click:function(t){return e.doSearch("tableData")}}},[e._v("查询")])],1),e._v(" "),a("div",[a("el-button",{staticClass:"view-btn-small",on:{click:e.selectImages}},[e._v("选择")]),e._v(" "),a("el-button",{staticClass:"view-btn-small",on:{click:e.handleClose}},[e._v("关闭")])],1)]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableData.loading,expression:"tableData.loading"}],staticClass:"tab-content",staticStyle:{"margin-top":"12px"},attrs:{data:e.tableData.msg,border:""}},[a("el-table-column",{attrs:{label:"","header-align":"center",align:"center",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{staticClass:"radio",attrs:{value:t.row.id,name:"imageId",label:t.row.id},nativeOn:{change:function(a){return e.getCurrentRow(t.row.id,t.row.name)}},model:{value:e.selectImage.id,callback:function(t){e.$set(e.selectImage,"id",t)},expression:"selectImage.id"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"name","show-overflow-tooltip":"",label:"镜像名称"}}),e._v(" "),a("el-table-column",{attrs:{property:"created_at",width:"180","show-overflow-tooltip":"",align:"center",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{property:"imageCategory.name",width:"150","show-overflow-tooltip":"",label:"镜像分类"}}),e._v(" "),a("el-table-column",{attrs:{property:"describe","show-overflow-tooltip":"",label:"镜像描述"}}),e._v(" "),a("div",{attrs:{slot:"empty"},slot:"empty"},[a("div",{staticClass:"views-empty"},[a("span",{staticClass:"views-empty-table"}),e._v(" "),a("p",{staticClass:"views-empty-text"},[e._v("你查询的结果为空")])])])],1),e._v(" "),a("el-pagination",{staticClass:"tab-page",attrs:{layout:"prev, pager, next","page-size":e.pageSize,"current-page":e.tableData.Pagination.page,total:e.tableData.Pagination.total_count},on:{"update:currentPage":function(t){return e.$set(e.tableData.Pagination,"page",t)},"update:current-page":function(t){return e.$set(e.tableData.Pagination,"page",t)},"current-change":function(t){return e.changePage("tableData")}}})],1)},staticRenderFns:[]},d=a("C7Lr")(r,c,!1,null,null,null).exports,m={name:"treeFiles",props:{url:{type:String,default:""},isInit:{type:String,default:""}},data:function(){return{props1:{label:"name",children:"zones",isLeaf:"leaf",key:"id",type:"type"},storage_id:"",storage_name:"",pid:0,dataArr:[]}},mounted:function(){},methods:{loadNode1:function(e,t){var a=this;console.log(e),""===this.url&&this.$message({message:"请求地址为空",type:"error"});var s={};0===e.level?(s.is_init=this.isInit,this.$post("/storage/storagelist",{StorageSearch:s}).then(function(e){return 200===e.code?(a.dataArr=e.data.storage_list,a.dataArr.forEach(function(e){return e.type=3,e.storage_id=e.id,e.storage_name=e.name,e.leaf=!1,e})):a.$message({message:e.message,type:"error"}),t(a.dataArr)})):(1===e.level?(this.storage_id=e.data.storage_id,this.storage_name=e.data.storage_name,this.pid=0):this.pid=e.data.id,this.$post(this.url,{storage_id:this.storage_id,pid:this.pid}).then(function(s){if(a.dataArr=s.data,a.dataArr.forEach(function(e){return e.type-0==2&&(e.leaf=!0,e.storage_name=a.storage_name),e}),e.level>=1)return t(a.dataArr)}))},handleNodeClick:function(e){this.$emit("dataTreeSelect",e)}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{height:"400px"}},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("el-tree",{attrs:{props:e.props1,load:e.loadNode1,"highlight-current":!0,"empty-text":"暂无数据",accordion:"",lazy:""},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node;return t.data,a("span",{staticClass:"custom-tree-node"},[3!=s.data.type||s.data.leaf?a("i",{staticClass:"iconfont",class:2==s.data.type?"icon-wenjian1":"icon-wenjianjia"}):a("i",{staticClass:"iconfont icon-xiangmu"}),e._v(" "),a("span",[e._v(e._s(s.label))])])}}])})],1)],1)},staticRenderFns:[]},g=a("C7Lr")(m,u,!1,null,null,null).exports,p={name:"codeDataDialog",props:{openDialog:{type:Boolean,default:!1}},components:{treeFiles:g},data:function(){return{props1:{label:"name",children:"zones",isLeaf:"leaf"},select:"",activeName:"first"}},mounted:function(){},methods:{handleClose:function(){this.$parent.dataCodeVisible=!1},handleSure:function(e){this.$emit("dataCodeClose",this.select)},dataTreeSelect:function(e){this.select=e},handleClick:function(e,t){}}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"选择数据和代码","before-close":e.handleClose,"close-on-click-modal":!1,visible:e.openDialog},on:{"update:visible":function(t){e.openDialog=t}}},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"公共存储空间列表",name:"first"}},[a("div",[a("treeFiles",{attrs:{url:"/storage/objectlistall",isInit:"1"},on:{dataTreeSelect:e.dataTreeSelect}})],1)])],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),a("el-button",{staticClass:"primary",attrs:{type:"primary"},on:{click:e.handleSure}},[e._v("确 定")])],1)],1)},staticRenderFns:[]},h={name:"createCase",components:{imageTableDialog:d,codeDataDialog:a("C7Lr")(p,_,!1,null,null,null).exports},data:function(){var e=this,t=function(t,a,s){o.d(a)?s():s(new Error(e.$t("views.validError.validStr")))};return{isCategoryName:!1,dataCodeVisible:!1,imageListVisible:!1,pageSize:10,openDialog1:!1,caseTypeArr:[],ruleForm:{case_name:"",date_code:"",storage_object_id:"",case_document_address:"",case_document_key:"",case_type:"",system_image_id:0,system_image_name:"",case_description:""},dailogForm1:{categoryName:""},dailogFormRules1:{categoryName:[{required:!0,message:this.$t("views.validError.notNull"),trigger:"blur"},{validator:t,trigger:"blur"}]},selections:[],rules:{case_name:[{required:!0,message:"请输入应用名称",trigger:"blur"},{validator:t,trigger:"blur"}],case_document_key:[{validator:function(e,t,a){""!==t&&/\s+/.test(t)?a(new Error("密码中不能包含空格")):a()},trigger:"blur"}],case_type:[{required:!0,message:"请选择应用分类",trigger:"blur"}],system_image_name:[{required:!0,message:"请选择关联镜像",trigger:"change"}],date_code:[{required:!0,message:"请选择数据和代码",trigger:"change"}],case_document_address:[{required:!0,message:"请输入应用文档链接",trigger:"blur"}]}}},created:function(){var e=this;if(this.getTypeList(),this.$route.query.hasOwnProperty("caseId")){var t=this.$route.query.caseId;this.$get("/casecenter/show",{case_center_id:t}).then(function(a){console.log(a),e.ruleForm.case_id=t,e.ruleForm.case_name=a.data.name,e.ruleForm.date_code=a.data.code_data,e.ruleForm.storage_object_id=a.data.storage_object_id,e.ruleForm.case_document_address=a.data.document_link,e.ruleForm.case_document_key=a.data.document_password,e.ruleForm.system_image_id=a.data.image_id,e.ruleForm.system_image_name=a.data.imageRel?a.data.imageRel.name:"",e.ruleForm.case_description=a.data.describe,e.$nextTick(function(){this.ruleForm.case_type=a.data.category})})}},methods:{selectImages:function(e){e.id&&0!==e.id?(this.ruleForm.system_image_id=e.id,this.ruleForm.system_image_name=e.name,this.$message({message:"选择成功",type:"success"}),this.imageListVisible=!1):this.$message({message:"请选择镜像",type:"error"})},getTypeList:function(e){var t=this;this.$get("/casecenter/casecentercategorylist").then(function(a){t.selections=[].concat(i()(a.data)),"function"==typeof e&&e()})},changeCategory:function(){-1===this.ruleForm.case_type&&(this.openDialog1=!0)},handleClose1:function(){this.$refs.dailogForm1.resetFields(),this.ruleForm.case_type=""},handleSure1:function(){var e=this;this.$refs.dailogForm1.validate(function(t){t&&(e.isCategoryName=!0,e.$post("/casecenter/addcasecentercategory",{name:e.dailogForm1.categoryName}).then(function(t){200===t.code?(e.isCategoryName=!1,e.$message({type:"success",message:e.$t("views.notification.saved")}),e.openDialog1=!1,e.getTypeList(function(){e.ruleForm.case_type=""+t.data.id})):(e.isCategoryName=!1,e.$message({type:"warning",message:t.message}))}))})},delCategory:function(e){var t=this,a=this.selections[e];this.$post("/casecenter/delcasecentercategory",{id:a}).then(function(e){200===e.code&&(t.$message({type:"success",message:t.$t("views.notification.removed")}),t.ruleForm.case_type="",t.getTypeList())})},modalClose:function(){this.imageListVisible=!1},dataCodeClose:function(e){e.leaf?(this.ruleForm.date_code=e.path,this.ruleForm.storage_object_id=e.id):this.$message({message:"请选择一个文件",type:"error"}),this.dataCodeVisible=!1},getImages:function(){this.imageListVisible=!0},getDataCode:function(){this.dataCodeVisible=!0},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a={};a.name=t.ruleForm.case_name,a.category=t.ruleForm.case_type,a.image_id=t.ruleForm.system_image_id,a.code_data=t.ruleForm.date_code,a.storage_object_id=t.ruleForm.storage_object_id,a.document_link=t.ruleForm.case_document_address,a.document_password=t.ruleForm.case_document_key,a.describe=t.ruleForm.case_description,t.$route.query.hasOwnProperty("caseId")?(a.case_center_id=t.$route.query.caseId,t.$post("/casecenter/update",a).then(function(e){if(200!==e.code)return t.$message({message:e.message,type:"error"}),!1;t.$message({message:"保存成功",type:"success"}),t.mixinGoBack()})):t.$post("/casecenter/create",a).then(function(e){if(200!==e.code)return t.$message({message:e.message,type:"error"}),!1;t.$message({message:"保存成功",type:"success"}),t.mixinGoBack()})}})},resetForm:function(e){this.$refs[e].resetFields()}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"create_case"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"应用名称",prop:"case_name"}},[a("el-input",{attrs:{maxlength:"30"},model:{value:e.ruleForm.case_name,callback:function(t){e.$set(e.ruleForm,"case_name","string"==typeof t?t.trim():t)},expression:"ruleForm.case_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"关联镜像",prop:"system_image_name"}},[a("el-input",{staticClass:"w8",attrs:{readonly:"true"},model:{value:e.ruleForm.system_image_name,callback:function(t){e.$set(e.ruleForm,"system_image_name",t)},expression:"ruleForm.system_image_name"}}),e._v(" "),a("el-button",{staticClass:"view-btn-medium",nativeOn:{click:function(t){return e.getImages(t)}}},[e._v("选择")])],1),e._v(" "),a("el-form-item",{attrs:{label:"数据和代码",prop:"date_code"}},[a("el-input",{staticClass:"w8",attrs:{readonly:"true"},model:{value:e.ruleForm.date_code,callback:function(t){e.$set(e.ruleForm,"date_code",t)},expression:"ruleForm.date_code"}}),e._v(" "),a("el-button",{staticClass:"view-btn-medium",on:{click:e.getDataCode}},[e._v("选择")])],1),e._v(" "),a("el-form-item",{attrs:{label:"应用文档链接",prop:"case_document_address"}},[a("el-input",{attrs:{maxlength:"255"},model:{value:e.ruleForm.case_document_address,callback:function(t){e.$set(e.ruleForm,"case_document_address",t)},expression:"ruleForm.case_document_address"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"加密文档密码",prop:"case_document_key"}},[a("el-input",{attrs:{maxlength:"16"},model:{value:e.ruleForm.case_document_key,callback:function(t){e.$set(e.ruleForm,"case_document_key",t)},expression:"ruleForm.case_document_key"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"应用分类",prop:"case_type"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:e.changeCategory},model:{value:e.ruleForm.case_type,callback:function(t){e.$set(e.ruleForm,"case_type",t)},expression:"ruleForm.case_type"}},[e._l(e.selections,function(t,s){return a("el-option",{key:s,attrs:{label:t.name,value:t.id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"12px"},on:{click:function(t){return e.delCategory(s)}}},[a("i",{staticClass:"iconfont icon-shanchu"})])])}),e._v(" "),a("el-option",{key:-1,attrs:{label:e.$t("views.imageManagement.customize"),value:-1}})],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"应用描述"}},[a("el-input",{attrs:{type:"textarea",rows:"8",maxlength:"200"},model:{value:e.ruleForm.case_description,callback:function(t){e.$set(e.ruleForm,"case_description",t)},expression:"ruleForm.case_description"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{on:{click:function(t){return e.mixinGoBack()}}},[e._v("返回")]),e._v(" "),a("el-button",{staticClass:"btn dark",on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"small",attrs:{title:"自定义应用分类",visible:e.openDialog1},on:{close:e.handleClose1,"update:visible":function(t){e.openDialog1=t}}},[a("div",[a("el-form",{ref:"dailogForm1",attrs:{model:e.dailogForm1,rules:e.dailogFormRules1,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.$t("views.imageManagement.typeImageName"),prop:"categoryName"}},[a("el-input",{attrs:{maxlength:"30",placeholder:e.$t("views.imageManagement.enter")},model:{value:e.dailogForm1.categoryName,callback:function(t){e.$set(e.dailogForm1,"categoryName","string"==typeof t?t.trim():t)},expression:"dailogForm1.categoryName"}})],1)],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.openDialog1=!1}}},[e._v(e._s(e.$t("views.button.cancel")))]),e._v(" "),a("el-button",{staticClass:"btn dark",attrs:{disabled:e.isCategoryName},on:{click:e.handleSure1}},[e._v(e._s(e.$t("views.button.save")))])],1)]),e._v(" "),a("imageTableDialog",{attrs:{openDialog:e.imageListVisible,selImageId:e.ruleForm.system_image_id},on:{"update:openDialog":function(t){e.imageListVisible=t},"update:open-dialog":function(t){e.imageListVisible=t},"update:selImageId":function(t){return e.$set(e.ruleForm,"system_image_id",t)},"update:sel-image-id":function(t){return e.$set(e.ruleForm,"system_image_id",t)},modalClose:e.modalClose,selectImage:e.selectImages}}),e._v(" "),a("codeDataDialog",{attrs:{openDialog:e.dataCodeVisible},on:{"update:openDialog":function(t){e.dataCodeVisible=t},"update:open-dialog":function(t){e.dataCodeVisible=t},dataCodeClose:e.dataCodeClose}})],1)},staticRenderFns:[]},v=a("C7Lr")(h,f,!1,null,null,null);t.default=v.exports}});