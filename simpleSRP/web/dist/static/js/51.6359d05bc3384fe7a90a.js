webpackJsonp([51],{tjIF:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("a3Yh"),i=s.n(a),o=s("IHPB"),c=s.n(o),l=s("ZoQJ"),r=s("v46e"),n={data:function(){var e=Object(l.b)(),t=new Date,s=Object(l.e)(t);return{dialogTask:!1,remarksDialog:!1,downDialog:!1,taskName:"",taskBasic:"",clearable:!1,taskarea:"",isDisabled:!1,editDisabled:!0,trainingDetails:[],practice_node:"",journal:"",pickerOptions:e,useProject:"height:400px;",taskResourcesData:[],practicenode:[],resources:"",obj:{practice_id:""},logParams:{practice_id:"",practice_node:""},node:"",resource:{pod_uid:"",time_status:1,practice_id:""},resourceData:"",labelWidth:"100px",ruleForm:{name:"",desc:""},descRules:{desc:[{required:!1,validator:function(e,t,s){""===t?s():Object(r.e)(t)?s():s(new Error("不得包含特殊字符:<>:'\"/\\."))},trigger:"blur"}]},createDevrules:{name:[{required:!0,validator:function(e,t,s){""===t?s(new Error("请输入名称")):Object(r.k)(t)?s():s(new Error("只能输入2-30位字母、数字、下划线"))},trigger:"blur"},{min:2,max:30,message:this.$t("views.development.youCan"),trigger:"blur"}]},nodeObj:{id:"",node:"",start_time:s,type:1},timer:"",timerNode:"",resourceTimer:""}},beforeRouteLeave:function(e,t,s){window.clearTimeout(this.timerNode),window.clearTimeout(this.timer),s()},created:function(){this.$store.dispatch("getTimestatus"),this.nodeObj.id=this.resource.practice_id=this.logParams.practice_id=this.obj.practice_id=this.$route.params.perTaskId,this.getDevelopmentDetails(this.obj),this.getResouseData(this.obj),this.postPracticenode(this.obj)},mounted:function(){this.getPracticelog(this.logParams)},methods:{formatSeconds:l.c,defaultValue:function(){},getDevelopmentDetails:function(e){var t=this;this.$post("/practiceproject/practicedetail",e).then(function(e){200===e.code?(t.taskBasic=e.data.practice,t.ruleForm.name=e.data.practice.name,t.ruleForm.desc=e.data.practice.describe):t.$message({message:e.message,type:"error"})})},postPracticenode:function(e){var t=this,s=this;this.$post("/practiceproject/practicenode",e).then(function(e){200===e.code?0===e.data.length?t.practicenode=[{label:"无数据",value:""}]:t.practicenode=[{label:"全部",value:""}].concat(c()(e.data.practice_node)):t.$message({message:e.message,type:"error"})}),this.timerNode=setTimeout(function(){s.postPracticenode(s.logParams)},1e4)},getPracticelog:function(e){var t=this,s=this;this.obj.practice_id=this.$route.params.perTaskId,this.$post("/practiceproject/practicelog",e).then(function(e){200===e.code?(0!==e.data.length?(t.isDisabled=!1,t.journal=e.data.practice_log):t.isDisabled=!0,t.timer=setTimeout(function(){s.getPracticelog(s.logParams)},1e4)):t.$message({message:e.message,type:"error"})})},getPracticeupdate:function(e){var t=this;this.$post("/practiceproject/practiceupdate",e).then(function(e){200===e.code?(t.$message({message:e.message,type:"success"}),t.getDevelopmentDetails(t.obj),t.getPracticelog(t.obj)):t.$message({message:e.message,type:"error"})})},getResouseData:function(e){var t=this;this.$post("/practiceproject/practiceresource",e).then(function(e){if(200===e.code){t.taskResourcesData=[];var s;t.trainingDetails=s=e.data;for(var a=0;a<s.length;a++)t.resource.pod_uid=s[a].pod_uid,t.practicenoderesource(t.resource,s[a])}else t.$message({message:e.message,type:"error"})})},practicenoderesource:function(e,t){var s=this,a=["#F17472","#42E1BB","#FEC633","#54BECC"];this.$post("/practiceproject/practicenoderesource",e).then(function(e){if(200===e.code){var i={},o=e.data;o.show.value=Object(l.j)(o.show.value),o.cpu.value=Object(l.j)(o.cpu.value),o.memory.value=Object(l.j)(o.memory.value),o.gpu.value=Object(l.j)(o.gpu.value),i.echarts=Object(l.f)(a,o),i.node_name=t.ndoe_name,i.node_type=t.type,i.pod_uid=t.pod_uid,i.value=1,s.taskResourcesData.push(i)}else s.$message({message:e.message,type:"error"})})},noderesource:function(e,t){var s=this,a=["#F17472","#42E1BB","#FEC633","#54BECC"];this.$post("/practiceproject/practicenoderesource",e).then(function(e){200===e.code?(s.taskResourcesData[t].echarts=Object(l.f)(a,e.data),s.taskResourcesData=[].concat(c()(s.taskResourcesData))):s.$message({message:e.message,type:"error"})})},changeDialogSingle:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var s=i()({practice_id:t.obj.practice_id},"Practice[name]",t.ruleForm.name);t.getPracticeupdate(s),t.dialogTask=!1})},remarksDialogSingle:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var s={practice_id:t.obj.practice_id,"Practice[describe]":t.ruleForm.desc};t.getPracticeupdate(s),t.remarksDialog=!1})},handleClose:function(e){e()},taskEdit:function(){this.ruleForm.name=this.taskBasic.name,this.dialogTask=!0},remarksEdit:function(){this.ruleForm.desc=this.taskBasic.describe,this.remarksDialog=!0},dialogCancel:function(e){this.$refs[e].resetFields(),this.dialogTask=!1},remarksCancel:function(e){this.$refs[e].resetFields(),this.remarksDialog=!1},trainingIndex:function(e){return e+1},changeLog:function(e){this.logParams.practice_node=e,this.getPracticelog(this.logParams)},downLog:function(){this.downDialog=!0},dialogSingleSure:function(){this.$store.commit("downloadlog",this.nodeObj),this.downDialog=!1},changeTimes:function(e,t,s){this.resource.time_status=e,this.resource.pod_uid=s.pod_uid,this.noderesource(this.resource,t)}},components:{},computed:{timestatus:function(){return this.$store.getters.postTimestatus}}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"views-personal"},[s("div",{staticClass:"views-header-inf"},[s("span",[e._v(e._s(e.$t("views.modelPrediction.basicInf")))])]),e._v(" "),""!==e.taskBasic?s("table",{staticClass:"views-project-details views-tabel-details"},[s("tr",[s("td",{staticClass:"views-basic-color1"},[e._v("任务名称")]),e._v(" "),s("td",{staticClass:"views-basic-name"},[s("el-input",{attrs:{placeholder:"",disabled:e.editDisabled},model:{value:e.taskBasic.name,callback:function(t){e.$set(e.taskBasic,"name",t)},expression:"taskBasic.name"}}),e._v(" "),s("i",{staticClass:"iconfont icon-edit views-icon-edit",on:{click:e.taskEdit}})],1),e._v(" "),s("td",{staticClass:"views-basic-color1"},[e._v("作业状态")]),e._v(" "),s("td",["0"===e.taskBasic.status?s("span",[e._v("运行失败")]):e._e(),e._v(" "),"1"===e.taskBasic.status?s("span",[e._v("运行中")]):e._e(),e._v(" "),"2"===e.taskBasic.status?s("span",[e._v("创建中")]):e._e(),e._v(" "),"3"===e.taskBasic.status?s("span",[e._v("运行成功")]):e._e(),e._v(" "),"4"===e.taskBasic.status?s("span",[e._v("停止")]):e._e()])]),e._v(" "),s("tr",[s("td",{staticClass:"views-basic-color2"},[e._v("引擎类型")]),e._v(" "),s("td",{staticClass:"views-basic-color3"},[e._v(e._s(e.taskBasic.engine))]),e._v(" "),s("td",{staticClass:"views-basic-color2"},[e._v("ID")]),e._v(" "),s("td",{staticClass:"views-basic-color3"},[e._v(e._s(e.taskBasic.practice_uid))])]),e._v(" "),s("tr",[s("td",{staticClass:"views-basic-color1"},[e._v("创建时间")]),e._v(" "),s("td",[e._v(e._s(e.taskBasic.created_at))]),e._v(" "),s("td",{staticClass:"views-basic-color1"},[e._v("运行时长")]),e._v(" "),s("td",[e._v(e._s(e.formatSeconds(e.taskBasic.used_time)))])]),e._v(" "),s("tr",[s("td",{staticClass:"views-basic-color2"},[e._v("运行参数")]),e._v(" "),s("td",{staticClass:"views-basic-color3 views-table-word text-ellipsis"},e._l(e.taskBasic.param,function(t,a){return s("div",{key:a,staticClass:"text-ellipsis"},[s("el-tooltip",{attrs:{placement:"bottom-end"}},[s("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(a)+":"+e._s(t))]),e._v(" "),s("span",{staticClass:"views-text-word"},[e._v(e._s(a)+":"+e._s(t))])])],1)}),0),e._v(" "),"tensorflow"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color2"},[e._v("代码目录")]):e._e(),e._v(" "),"tensorflow"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color3"},[s("div",{staticClass:"views-table-word"},[e._v("\n          "+e._s(e.taskBasic.mount_info.code_path.s3_path)+"\n        ")])]):e._e(),e._v(" "),"caffe"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color1"},[e._v("训练数据路径")]):e._e(),e._v(" "),"caffe"===e.taskBasic.engine?s("td",[s("div",{staticClass:"views-table-word"},[e._v("\n          "+e._s(e.taskBasic.mount_info.train_data_dir.s3_path)+"\n        ")])]):e._e()]),e._v(" "),s("tr",[s("td",{staticClass:"views-basic-color1"},[e._v("计算节点个数")]),e._v(" "),s("td",[e._v(e._s(e.taskBasic.node_num))]),e._v(" "),"tensorflow"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color1"},[e._v("训练数据集")]):e._e(),e._v(" "),"tensorflow"===e.taskBasic.engine?s("td",[s("div",{staticClass:"views-table-word"},[e._v("\n          "+e._s(e.taskBasic.mount_info.dataset.s3_path)+"\n        ")])]):e._e(),e._v(" "),"caffe"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color1"},[e._v("测试数据路径")]):e._e(),e._v(" "),"caffe"===e.taskBasic.engine?s("td",[s("div",{staticClass:"views-table-word"},[e._v("\n          "+e._s(e.taskBasic.mount_info.test_data_dir.s3_path)+"\n        ")])]):e._e()]),e._v(" "),s("tr",[s("td",{staticClass:"views-basic-color2"},[e._v("计算节点规格")]),e._v(" "),s("td",{staticClass:"views-basic-color3"},[s("span",{staticClass:"views-table-margin"},[e._v("\n          CPU:"+e._s(e.taskBasic.cpu)+" 核\n        ")]),e._v(" "),s("span",[e._v("\n          GPU:"+e._s(e.taskBasic.gpu)+" 个\n        ")]),e._v(" "),s("span",{staticClass:"views-table-margin"},[e._v("\n          内存:"+e._s(e.taskBasic.memory)+" G\n        ")])]),e._v(" "),"tensorflow"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color2"},[e._v("启动文件")]):e._e(),e._v(" "),"tensorflow"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color3"},[s("div",{staticClass:"views-table-word"},[e._v("\n          "+e._s(e.taskBasic.mount_info.launch_script.s3_path)+"\n        ")])]):e._e(),e._v(" "),"caffe"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color1"},[e._v("网络层文件")]):e._e(),e._v(" "),"caffe"===e.taskBasic.engine?s("td",[s("div",{staticClass:"views-table-word"},[e._v("\n          "+e._s(e.taskBasic.mount_info.proto_file.s3_path)+"\n        ")])]):e._e()]),e._v(" "),s("tr",[s("td",{staticClass:"views-basic-color1"},[e._v("可视化链接")]),e._v(" "),s("td",{staticClass:"views-table-link"},["1"===e.taskBasic.status?s("a",{attrs:{href:e.taskBasic.tensorboard_url,target:"_blank"}},[e._v(e._s(e.taskBasic.tensorboard_url))]):s("span",[e._v("\n          "+e._s(e.taskBasic.tensorboard_url)+"\n        ")])]),e._v(" "),"tensorflow"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color1"},[e._v("训练日志目录")]):e._e(),e._v(" "),"tensorflow"===e.taskBasic.engine?s("td",[s("div",{staticClass:"views-table-word"},[e._v("\n          "+e._s(e.taskBasic.mount_info.model_path.s3_path)+"\n        ")])]):e._e(),e._v(" "),"caffe"===e.taskBasic.engine?s("td",{staticClass:"views-basic-color1"},[e._v("模型保存路径")]):e._e(),e._v(" "),"caffe"===e.taskBasic.engine?s("td",[s("div",{staticClass:"views-table-word"},[e._v("\n          "+e._s(e.taskBasic.mount_info.snapshot_prefix.s3_path)+"\n        ")])]):e._e()])]):e._e(),e._v(" "),e._m(0),e._v(" "),s("div",{staticClass:"views-develop-remarks"},[s("div",{staticClass:"views-develop-edit"},[s("i",{staticClass:"iconfont icon-edit views-icon-edit",on:{click:e.remarksEdit}})]),e._v(" "),s("el-input",{attrs:{type:"textarea",rows:8,maxlength:"200",placeholder:"请输入内容",disabled:e.editDisabled},model:{value:e.taskBasic.describe,callback:function(t){e.$set(e.taskBasic,"describe",t)},expression:"taskBasic.describe"}})],1),e._v(" "),e._m(1),e._v(" "),s("div",{staticClass:"views-task-news"},[s("div",{staticClass:"views-task-select"},[s("el-select",{ref:"changeFocus",attrs:{placeholder:"请选择"},on:{change:e.changeLog},model:{value:e.logParams.practice_node,callback:function(t){e.$set(e.logParams,"practice_node",t)},expression:"logParams.practice_node"}},e._l(e.practicenode,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value,title:e.label}})}),1),e._v(" "),s("el-button",{staticClass:"view-btn-medium",attrs:{type:"primary",disabled:e.isDisabled},on:{click:e.downLog}},[e._v("下载日志")])],1)]),e._v(" "),s("p",{staticClass:"views-task-text"},[e._v("在运行日志内使用鼠标上下滚动获取更多的日志")]),e._v(" "),s("div",{staticClass:"views-task-log"},[s("el-scrollbar",{staticStyle:{height:"100%"}},[s("div",{staticClass:"veiws-text-log"},e._l(e.journal,function(t,a){return s("div",{key:a,staticClass:"views-text-span"},[s("span",[e._v(e._s(a)+"：")]),e._v(" "),e._l(t,function(t,a){return s("div",{key:a},[e._v("\n            "+e._s(t)+"\n          ")])})],2)}),0)])],1),e._v(" "),e._m(2),e._v(" "),s("div",{staticClass:"views-table-content"},[s("el-table",{ref:"multipleTable",staticClass:"tab-content",staticStyle:{width:"100%"},attrs:{data:e.trainingDetails,"tooltip-effect":"dark",border:""}},[s("el-table-column",{attrs:{prop:"ndoe_name",label:"节点名称",width:"300","header-align":"center",align:"center","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"节点类型",width:"100","header-align":"center",align:"center","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"CPU使用率","header-align":"center",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v("\n            "+e._s(t.row.cpu)+"%\n          ")])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"memory_use",label:"内存使用","show-overflow-tooltip":"","header-align":"center",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v("\n            "+e._s(t.row.memory_use)+"G\n          ")]),e._v("\n          /"),s("span",[e._v("\n            "+e._s(t.row.memory_all)+"G\n          ")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"GPU使用率","header-align":"center",align:"left","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.gpu,function(t,a){return s("span",{key:a,staticClass:"views-table-details views-table-margin",attrs:{size:"mini"}},[e._v("\n            "+e._s(t.name)+" : "+e._s(t.value)+"\n          ")])})}}])}),e._v(";\n      "),s("el-table-column",{attrs:{label:"显存使用","header-align":"center",align:"left","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.show,function(t,a){return s("span",{key:a,staticClass:"views-table-details views-table-margin",attrs:{size:"mini"}},[e._v("\n            "+e._s(t.name)+" : "+e._s(t.value)+"\n          ")])})}}])})],1),e._v(" "),s("div",{staticClass:"views-charts-box"},e._l(e.taskResourcesData,function(t,a){return s("div",{key:a,staticClass:"views-charts-mt views-charts-task"},[s("div",{staticClass:"views-node-name"},[s("span",[e._v("节点名称："+e._s(t.node_name))]),e._v(" "),s("span",[e._v("（节点类型："+e._s(t.node_type)+"）")])]),e._v(" "),s("div",{staticClass:"views-chats-times"},[s("el-select",{attrs:{placeholder:"请选择",name:String(a)},on:{change:function(s){return e.changeTimes(s,a,t)}},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}},e._l(e.timestatus,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),s("sedu-echarts",{attrs:{domId:"taskUse"+a,option:t.echarts,myStyle:e.useProject}})],1)}),0)],1),e._v(" "),s("el-dialog",{attrs:{title:"修改任务名称",visible:e.dialogTask,width:"30%","before-close":e.handleClose,top:"30vh","custom-class":"views-dialog"},on:{"update:visible":function(t){e.dialogTask=t}}},[s("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.createDevrules,"label-width":e.labelWidth}},[s("div",{staticClass:"views-modify-name"},[s("el-form-item",{attrs:{label:e.$t("views.trainingTask.taskName"),prop:"name"}},[s("el-input",{attrs:{placeholder:e.$t("views.development.youCan"),minlength:"2",maxlength:"30",clearable:""},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1)],1)]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"cancel",on:{click:function(t){return e.dialogCancel("ruleForm")}}},[e._v("取 消")]),e._v(" "),s("el-button",{staticClass:"primary",attrs:{type:"primary"},on:{click:function(t){return e.changeDialogSingle("ruleForm")}}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"修改备注信息",visible:e.remarksDialog,width:"30%","before-close":e.handleClose,top:"30vh","custom-class":"views-dialog"},on:{"update:visible":function(t){e.remarksDialog=t}}},[s("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.descRules,"label-width":e.labelWidth}},[s("div",{staticClass:"views-dialog-develop"},[s("el-form-item",{attrs:{label:"备注信息",prop:"desc"}},[s("el-input",{attrs:{type:"textarea",rows:8,maxlength:"200",placeholder:"请输入内容"},model:{value:e.ruleForm.desc,callback:function(t){e.$set(e.ruleForm,"desc",t)},expression:"ruleForm.desc"}})],1)],1)]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"cancel",on:{click:function(t){e.remarksCancel("ruleForm")}}},[e._v("取 消")]),e._v(" "),s("el-button",{staticClass:"primary",attrs:{type:"primary"},on:{click:function(t){return e.remarksDialogSingle("ruleForm")}}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"下载日志",visible:e.downDialog,width:"30%","before-close":e.handleClose,top:"30vh","custom-class":"views-dialog"},on:{"update:visible":function(t){e.downDialog=t}}},[s("div",{staticClass:"views-dialog-develop views-dialog-loading"},[s("div",[s("span",{staticClass:"tab-select-title tab-select-mg"},[e._v("选择节点：")]),e._v(" "),s("el-select",{attrs:{placeholder:e.$t("views.development.pleaseChoose"),clearable:""},model:{value:e.nodeObj.node,callback:function(t){e.$set(e.nodeObj,"node",t)},expression:"nodeObj.node"}},e._l(e.practicenode,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value,title:e.label}})}),1)],1),e._v(" "),s("div",{staticClass:"views-input-box views-input-time"},[s("span",{staticClass:"tab-select-title  tab-select-mg"},[e._v("选择时间：")]),e._v(" "),s("div",{staticClass:"views-date-picter"},[s("el-date-picker",{attrs:{align:"right",type:"date",editable:!1,"value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期","picker-options":e.pickerOptions,clearable:e.clearable},model:{value:e.nodeObj.start_time,callback:function(t){e.$set(e.nodeObj,"start_time",t)},expression:"nodeObj.start_time"}}),s("span",{staticClass:"views-time-now"},[e._v(" ~ 现在")])],1)])]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{staticClass:"cancel",on:{click:function(t){e.downDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{staticClass:"primary",attrs:{type:"primary"},on:{click:e.dialogSingleSure}},[e._v("确 定")])],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"views-header-inf"},[t("span",[this._v("备注信息")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"views-header-inf"},[t("span",[this._v("训练日志")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"views-header-inf"},[t("span",[this._v("资源监控")])])}]},v=s("C7Lr")(n,d,!1,null,null,null);t.default=v.exports}});