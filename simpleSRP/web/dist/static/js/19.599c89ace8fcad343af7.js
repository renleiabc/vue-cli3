webpackJsonp([19],{"/nBV":function(e,t,a){"use strict";var i=a("IHPB"),s=a.n(i),l=a("aA9S"),n=a.n(l),o={name:"shareProjectImage",props:{selImageId:Array,imageId:"",openDialog:{type:Boolean,default:!1}},data:function(){return{pageSize:10,selectImage:[],tableData:{msg:[],url:"/project/allselfproject",loading:!0,Pagination:{page:1,total_count:5},sel:{name:"",image_id:""}}}},mounted:function(){this.selectImage=this.selImageId,this.tableData.sel.image_id=this.imageId,console.log(this.tableData),this.getActiveTab("tableData")},methods:{getActiveTab:function(e){this.linTabData=e,this.linUrl=this[e].url,this.initMsg()},selectable:function(e){return!(Number(e.share)>0)},clearSearch:function(e){for(var t in this[e].sel)this[e].sel[t]="";void 0!==this[e].Pagination&&(this[e].Pagination.page=1),this.getActiveTab(e)},doSearch:function(e){void 0!==this[e].Pagination&&(this[e].Pagination.page=1),this.getActiveTab(e)},changePage:function(e){this.getActiveTab(e)},selectImageArr:function(e){var t=this,a=[];e.map(function(e,i){t.selImageId.includes(e.id)&&a.push(e)}),this.toggleSelection(a)},initMsg:function(){var e=this;this[this.linTabData].loading=!0;var t={};void 0!==this[this.linTabData].Pagination&&(t=n()({},this[this.linTabData].Pagination,{count:this.pageSize})),void 0!==this[this.linTabData].sel&&(t=n()({},t,this[this.linTabData].sel)),this.$axios.get(this[this.linTabData].url,{params:t}).then(function(t){var a=t.data.data.all_project;e[e.linTabData].msg=[].concat(s()(a)),e.selectImageArr(e[e.linTabData].msg),void 0!==e[e.linTabData].Pagination&&(e[e.linTabData].Pagination.total_count=t.data.data.total_count),e.pageSize=t.data.data.per_page||10,e[e.linTabData].loading=!1})},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$nextTick(function(){this.$refs.multipleTable.toggleRowSelection(e,!0)})}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){var t=this;this.selectImage=[],e&&e.forEach(function(e){t.selectImage.push(e.id)})},handleClose:function(){this.$parent.selProjectDialog=!1},selectImages:function(){this.$emit("selectImage",this.selectImage)}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"big shareSelectDialog",attrs:{title:this.$t("views.imageManagement.personalImage.p3"),"before-close":e.handleClose,visible:e.openDialog},on:{"update:visible":function(t){e.openDialog=t}}},[a("div",{staticClass:"image-sel"},[a("div",{staticClass:"query-v"},[a("span",[e._v(e._s(e.$t("views.imageManagement.projectName")))]),e._v(" "),a("el-input",{attrs:{size:"small"},model:{value:e.tableData.sel.name,callback:function(t){e.$set(e.tableData.sel,"name",t)},expression:"tableData.sel.name"}}),e._v(" "),a("el-button",{staticClass:"btn light small",on:{click:function(t){return e.clearSearch("tableData")}}},[e._v(e._s(e.$t("views.imageManagement.reset")))]),e._v(" "),a("el-button",{staticClass:"views-btn-query",on:{click:function(t){return e.doSearch("tableData")}}},[e._v(e._s(e.$t("views.button.search")))])],1)]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableData.loading,expression:"tableData.loading"}],ref:"multipleTable",staticClass:"tab-content",staticStyle:{"margin-top":"12px"},attrs:{data:e.tableData.msg,border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",selectable:e.selectable,align:"center",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{property:"name",label:e.$t("views.imageManagement.projectName")}}),e._v(" "),a("el-table-column",{attrs:{property:"created_at",align:"center",width:"180",label:e.$t("views.table.createTime")}}),e._v(" "),a("el-table-column",{attrs:{property:"describe",label:e.$t("views.imageManagement.projectDescription")}}),e._v(" "),a("div",{attrs:{slot:"empty"},slot:"empty"},[a("div",{staticClass:"views-empty"},[a("span",{staticClass:"views-empty-table"}),e._v(" "),a("p",{staticClass:"views-empty-text"},[e._v(e._s(e.$t("views.table.noData")))])])])],1),e._v(" "),a("el-pagination",{staticClass:"tab-page",attrs:{layout:"prev, pager, next","page-size":e.pageSize,"current-page":e.tableData.Pagination.page,total:e.tableData.Pagination.total_count},on:{"update:currentPage":function(t){return e.$set(e.tableData.Pagination,"page",t)},"update:current-page":function(t){return e.$set(e.tableData.Pagination,"page",t)},"current-change":function(t){return e.changePage("tableData")}}}),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handleClose}},[e._v(e._s(e.$t("views.button.cancel")))]),e._v(" "),a("el-button",{staticClass:"btn dark",on:{click:e.selectImages}},[e._v(e._s(e.$t("views.button.sure")))])],1)],1)},staticRenderFns:[]},c=a("C7Lr")(o,r,!1,null,null,null);t.a=c.exports},tQcI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("aA9S"),s=a.n(i),l=a("IHPB"),n=a.n(l),o=a("dclA"),r={name:"objectImage",components:{shareProjectImage:a("/nBV").a,ImageDetail:o.a},data:function(){return{selProjectDialog:!1,pickerOptions:{shortcuts:[{text:this.$t("views.imageManagement.recentOneWeek"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:this.$t("views.imageManagement.recentOneMonth"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:this.$t("views.imageManagement.recentThreeMonth"),onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},imageTypeOptions:[],imageStatusOptions:[{value:0,label:"上传中"},{value:1,label:"可用"},{value:2,label:"失败"}],pageSize:10,shareType:1,detailDialogVisible:!1,shareImageDialog:!1,detailData:{},multipleSelection:[],tableData:{msg:[],url:"/image/imagelist",loading:!1,Pagination:{page:1,total_count:1},sel:{is_init:0,name:"",sort:"",category:"",status:"",full_date:"",start_time:"",end_time:""}},shareImageId:"",imageId:"",selectedId:[]}},created:function(){var e=this;this.initMsg(),this.$get("/image/imagecategorylist",{is_init:this.tableData.sel.is_init}).then(function(t){200===t.code&&(e.imageTypeOptions=t.data.category)})},methods:{shareSaveType:function(){var e=this;setTimeout(function(){1===e.shareType?e.mixinConfirm("/image/imageshare",{image_id:e.shareImageId,is_init:1},e.$t("views.imageManagement.shareImage1")).then(function(t){t&&e.initMsg()}):e.selProjectDialog=!0,e.shareImageDialog=!1},200)},typeClose:function(){this.shareType=1},sortTable:function(e){"descending"===e.order?this.tableData.sel.sort="-"+e.prop:this.tableData.sel.sort=e.prop,this.initMsg()},selectImage:function(e){var t=this;console.log(e),e.length>0?this.$post("/image/imageshare",{image_id:this.shareImageId,is_init:2,project_id:e}).then(function(e){200===e.code?(t.initMsg(),t.selProjectDialog=!1,t.$message({type:"success",message:"共享成功，请到项目镜像管理处查看！"})):t.$message({type:"error",message:e.message})}):this.$message({type:"warning",message:this.$t("views.dialogText.selectNull")})},handleDetail:function(e,t){this.detailDialogVisible=!0,this.detailData=t},handleSelectionChange:function(e){var t=this;this.multipleSelection=[],e&&e.forEach(function(e,a,i){t.multipleSelection.push(e.id)}),this.multipleSelection=[].concat(n()(this.multipleSelection))},deleteMulImage:function(){this.multipleSelection.length?this.deleteRequest(this.multipleSelection):this.$message({type:"warning",message:this.$t("views.dialogText.selectNull")})},deleteSingleImage:function(e){this.deleteRequest([e])},clearSearch:function(){for(var e in this.tableData.sel)this.tableData.sel[e]="",this.tableData.sel.is_init=0;void 0!==this.tableData.Pagination&&(this.tableData.Pagination.page=1),this.initMsg()},initMsg:function(){var e=this;this.tableData.loading=!0;var t={};void 0!==this.tableData.Pagination&&(t={count:this.pageSize,page:this.tableData.Pagination.page}),void 0!==this.tableData.sel&&(this.tableData.sel.full_date&&2===this.tableData.sel.full_date.length?(this.tableData.sel.start_time=this.tableData.sel.full_date[0]+" 00:00:00",this.tableData.sel.end_time=this.tableData.sel.full_date[1]+" 23:59:59"):(this.tableData.sel.start_time="",this.tableData.sel.end_time=""),t=s()({},t,this.tableData.sel)),this.$get(this.tableData.url,t).then(function(t){var a=t.data.image_list;e.tableData.msg=[].concat(n()(a)),void 0!==e.tableData.Pagination&&(e.tableData.Pagination.total_count=t.data.total_count),e.pageSize=t.data.per_page||10,e.tableData.loading=!1})},deleteRequest:function(e){var t=this;this.mixinConfirm("/image/imagedelete",{image_id:e}).then(function(e){e&&t.initMsg()})},shareImage:function(e){this.shareImageDialog=!0,this.shareImageId=e},changeImage:function(e){console.log(e),isNaN(e)?(this.imageId="",this.$router.push({name:"perEditImage",query:{is_init:0}})):(this.imageId=e,this.$router.push({name:"perEditImage",query:{imageId:e,is_init:0}}))}},beforeRouteLeave:function(e,t,a){"perEditImage"===e.name&&(""===this.imageId?e.meta.title="views.nav.addImage":e.meta.title="views.nav.editImage"),a()}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"views-personal-image-manage"},[a("div",{staticClass:"tab-select"},[a("div",[a("span",{staticClass:"tab-select-title"},[e._v(e._s(e.$t("views.imageManagement.mirrorName")))]),e._v(" "),a("el-input",{attrs:{placeholder:e.$t("views.imageManagement.enter")},model:{value:e.tableData.sel.name,callback:function(t){e.$set(e.tableData.sel,"name",t)},expression:"tableData.sel.name"}})],1),e._v(" "),a("div",[a("span",{staticClass:"tab-select-title"},[e._v(e._s(e.$t("views.imageManagement.creationTime")))]),e._v(" "),a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","value-format":"yyyy-MM-dd","range-separator":"-","start-placeholder":e.$t("views.imageManagement.beginTime"),"end-placeholder":e.$t("views.imageManagement.endTime"),"picker-options":e.pickerOptions},model:{value:e.tableData.sel.full_date,callback:function(t){e.$set(e.tableData.sel,"full_date",t)},expression:"tableData.sel.full_date"}})],1),e._v(" "),a("div",[a("span",{staticClass:"tab-select-title"},[e._v(e._s(e.$t("views.imageManagement.status")))]),e._v(" "),a("el-select",{attrs:{clearable:"",filterable:"",placeholder:e.$t("views.imageManagement.chose")},model:{value:e.tableData.sel.status,callback:function(t){e.$set(e.tableData.sel,"status",t)},expression:"tableData.sel.status"}},e._l(e.imageStatusOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("span",{staticClass:"tab-select-title"},[e._v(e._s(e.$t("views.imageManagement.mirrorClassification")))]),e._v(" "),a("el-select",{attrs:{clearable:"",filterable:"",placeholder:e.$t("views.imageManagement.chose")},model:{value:e.tableData.sel.category,callback:function(t){e.$set(e.tableData.sel,"category",t)},expression:"tableData.sel.category"}},e._l(e.imageTypeOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("div",[a("el-button",{staticClass:"btn light small",on:{click:function(t){return e.clearSearch("tableData")}}},[e._v(e._s(e.$t("views.imageManagement.reset")))]),e._v(" "),a("el-button",{staticClass:"btn light small",on:{click:function(t){return e.initMsg()}}},[e._v(e._s(e.$t("views.imageManagement.select")))])],1)]),e._v(" "),a("div",{staticClass:"controls-else"},[a("el-button",{staticClass:"btn dark mid",on:{click:function(t){return e.changeImage()}}},[e._v("\n      "+e._s(e.$t("views.imageManagement.createMirror"))+"\n    ")]),e._v(" "),a("el-button",{staticClass:"btn dark mid",on:{click:function(t){return e.deleteMulImage()}}},[e._v(e._s(e.$t("views.imageManagement.deleteMirror")))])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableData.loading,expression:"tableData.loading"}],staticClass:"tab-content",staticStyle:{"margin-top":"10px"},attrs:{data:e.tableData.msg,border:""},on:{"sort-change":e.sortTable,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("views.imageManagement.mirrorName"),sortable:"custom",prop:"name","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{size:"mini"},on:{click:function(a){return e.handleDetail(t.$index,t.row)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("views.imageManagement.status"),"show-overflow-tooltip":"",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(0==t.row.status?"上传中":1==t.row.status?"可用":"失败"))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"created_at","show-overflow-tooltip":"",sortable:"custom",label:e.$t("views.imageManagement.creationTime"),width:"200px",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"category",sortable:"custom","show-overflow-tooltip":"",label:e.$t("views.imageManagement.mirrorClassification"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.imageCategory.name))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"describe","show-overflow-tooltip":"",label:e.$t("views.imageManagement.mirrorDescription")}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("views.imageManagement.operating"),width:"180px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("button",{staticClass:"btn",on:{click:function(a){return e.changeImage(t.row.id)}}},[e._v(e._s(e.$t("views.imageManagement.modify")))]),e._v(" "),1==t.row.status?a("button",{staticClass:"btn",on:{click:function(a){return e.shareImage(t.row.id)}}},[e._v("共享")]):e._e(),e._v(" "),a("button",{staticClass:"del",on:{click:function(a){return e.deleteSingleImage(t.row.id)}}},[e._v(e._s(e.$t("views.imageManagement.delete")))])]}}])}),e._v(" "),a("div",{attrs:{slot:"empty"},slot:"empty"},[a("div",{staticClass:"views-empty"},[a("span",{staticClass:"views-empty-table"}),e._v(" "),a("p",{staticClass:"views-empty-text"},[e._v(e._s(e.$t("views.table.noData")))])])])],1),e._v(" "),a("el-pagination",{staticClass:"tab-page",attrs:{layout:"prev, pager, next","page-size":e.pageSize,"current-page":e.tableData.Pagination.page,total:e.tableData.Pagination.total_count},on:{"update:currentPage":function(t){return e.$set(e.tableData.Pagination,"page",t)},"update:current-page":function(t){return e.$set(e.tableData.Pagination,"page",t)},"current-change":function(t){return e.initMsg()}}}),e._v(" "),a("el-dialog",{attrs:{title:e.$t("views.imageManagement.mirrorDetails"),visible:e.detailDialogVisible},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[a("image-detail",{attrs:{detailData:e.detailData}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"primary",attrs:{type:"primary"},on:{click:function(t){e.detailDialogVisible=!1}}},[e._v(e._s(e.$t("views.imageManagement.close")))])],1)],1),e._v(" "),a("el-dialog",{staticClass:"small",attrs:{title:e.$t("views.imageManagement.personalImage.p1"),visible:e.shareImageDialog},on:{close:e.typeClose,"update:visible":function(t){e.shareImageDialog=t}}},[a("div",{staticClass:"share-dialog"},[a("p",{staticStyle:{"line-height":"200%"}},[e._v(e._s(e.$t("views.imageManagement.personalImage.p2")+":"))]),e._v(" "),a("el-row",[a("el-radio",{attrs:{label:1},model:{value:e.shareType,callback:function(t){e.shareType=t},expression:"shareType"}},[e._v(e._s(e.$t("views.imageManagement.publicMirror")))])],1),e._v(" "),a("el-row",[a("el-radio",{attrs:{label:2},model:{value:e.shareType,callback:function(t){e.shareType=t},expression:"shareType"}},[e._v(e._s(e.$t("views.imageManagement.projectMirror")))])],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.shareImageDialog=!1}}},[e._v(e._s(e.$t("views.button.cancel")))]),e._v(" "),a("el-button",{staticClass:"btn dark",on:{click:e.shareSaveType}},[e._v(e._s(e.$t("views.button.sure")))])],1)]),e._v(" "),e.selProjectDialog?a("shareProjectImage",{attrs:{imageId:e.shareImageId,openDialog:e.selProjectDialog,selImageId:e.selectedId},on:{"update:openDialog":function(t){e.selProjectDialog=t},"update:open-dialog":function(t){e.selProjectDialog=t},selectImage:e.selectImage}}):e._e()],1)},staticRenderFns:[]},g=a("C7Lr")(r,c,!1,null,null,null);t.default=g.exports}});